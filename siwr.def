Bootstrap: docker
From: ubuntu:22.04

%files
   ## Copy subdirectory into the root directory of the container
   . /

%post
    ## Add info for tzdata
    export TZ=Europe/Stockholm
    ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

    ## Install all necessary dependencies.
    apt-get update
    apt-get install --no-install-recommends -y \
    wget \
	build-essential \
	ca-certificates \
	xutils-dev \
	cmake \
	gcc-multilib \
	flex \
	bison \
    libboost-python-dev\
	python2.7 \
    python-dev-is-python3 \
	libjudy-dev \
	g++-multilib \
	g++

    ## Install boost
    wget --no-check-certificate 'https://boostorg.jfrog.io/artifactory/main/release/1.82.0/source/boost_1_82_0.tar.gz'
    tar xf boost_1_82_0.tar.gz
    cd /boost_1_82_0
    ./bootstrap.sh
    export CXXFLAGS="-fPIC"
    ./b2 cxxflags="$CXXFLAGS" link=static
    export BOOST_ROOT="/boost_1_82_0"
    export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:/boost_1_82_0/stage/lib"
    export CPLUS_INCLUDE_PATH="$CPLUS_INCLUDE_PATH:/boost_1_82_0/include"

	## Install Mimir
    cd /
    rm -rf build
    cmake -S . -B build
    cmake --build build -j4

	## Remove packages unneeded for running the planner.
    apt-get -y autoremove cmake \
        build-essential \
        ca-certificates \
        xutils-dev \
        scons \
        gcc-multilib \
        flex \
        bison \
        g++-multilib \
        g++
    rm -rf /var/lib/apt/lists/*

%runscript
    ## The runscript is called whenever the container is used to solve
    ## an instance.

    DOMAINFILE=$1
    PROBLEMFILE=$2
    WIDTH=$3
    SKETCHFILE=$4
    ENABLE_GROUNDING=$5

    ## Call your planner using FD-parser.
    /build/src/public/siwr $DOMAINFILE $PROBLEMFILE $WIDTH $SKETCHFILE $ENABLE_GROUNDING

## Update the following fields with meta data about your submission.
## Please use the same field names and use only one line for each value.
%labels
Name        MIMIR-SIWR
Description SIWR implemented with MIMIR
Authors     Dominik Drexler <dominik.drexler@liu.se>
